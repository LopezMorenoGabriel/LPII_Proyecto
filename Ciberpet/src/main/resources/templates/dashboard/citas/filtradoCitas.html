<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" th:replace="shared/layout-admin :: layoutBase(~{::contenido})">

<div th:fragment="contenido">
	<div class="container mt-4">
		<div class="card shadow-sm">
			<div class="card-header bg-primary text-light d-flex justify-content-between align-items-center">
				<h5 class="mb-0">Lista de Citas</h5>
			</div>
			<div class="card-body">
				<!-- Filtro por servicio -->
				<form th:action="@{/filtradoCitas}" method="get" th:object="${filtro}">
					<div class="row mb-3">
						<div class="col-md-4">
							<label class="form-label">Servicio</label>
							<select class="form-select" th:field="*{idServicio}" onchange="this.form.submit()">
								<option value="">-- Todos los servicios --</option>
								<option th:each="s : ${servicios}" th:value="${s.idServicio}"
									th:text="${s.nomServicio}"></option>
							</select>
						</div>
					</div>
					<div class="row mb-3">
						<div class="col-md-4">
							<label class="form-label">Estado</label>
							<select class="form-select" th:field="*{estado}" onchange="this.form.submit()">
								<option value="">-- Todos --</option>
								<option th:value="P">Pendiente</option>
								<option th:value="E">En espera</option>
								<option th:value="C">Cancelada</option>
								<option th:value="A">Atendida</option>
							</select>
						</div>
					</div>
				</form>

				<!-- Tabla de citas -->
				<div class="table-responsive">
					<table id="tblCitas" class="table table-hover table-striped align-middle">
						<thead class="table-dark text-center">
							<tr>
								<th>#</th>
								<th>Cliente</th>
								<th>Servicio</th>
								<th>Fecha</th>
								<th>Hora</th>
								<th>Motivo</th>
								<th>Estado</th>
								<th>Acciones</th>
							</tr>
						</thead>
						<tbody class="table-secondary">
							<tr th:each="cita, stat : ${lstCita}">
								<td th:text="${stat.count}" class="text-center"></td>
								<td th:text="${cita.usuario.nombre + ' ' + cita.usuario.apellidos}"></td>
								<td th:text="${cita.servicio.nomServicio}"></td>
								<td th:text="${cita.fechaCita}"></td>
								<td th:text="${cita.horaCita}"></td>
								<td th:text="${cita.motivo}"></td>
								<td th:text="${cita.nombreEstado}"></td>
								<td class="text-center">
									<div class="d-flex justify-content-center gap-2">
										<a th:href="@{/edicionCita/{id}(id=${cita.idCita})}"
											class="btn btn-outline-primary btn-sm">Editar</a>
										<a th:href="@{/eliminarCita/{id}(id=${cita.idCita})}"
											class="btn btn-outline-danger btn-sm">Eliminar</a>
									</div>
								</td>
							</tr>
						</tbody>
					</table>
				</div>

				<!-- Toast o alertas -->
				<th:block th:utext="${toast}"></th:block>

			</div>
		</div>
	</div>
	<script>
		$(document).ready(function () {
			$('#tblCitas').DataTable({
				language: {
					url: 'https://cdn.datatables.net/plug-ins/2.0.3/i18n/es-ES.json',
					search: "Filtro general:",
				}
			});
		});
	</script>
</div>

</html>